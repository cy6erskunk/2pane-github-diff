!function(a,b,c){function d(a,b,c){return!this instanceof d?new d(a,b,c):(this.diffModel=c,this._initDiffData(a,b)._setDiffStartLines(),this)}function e(a){return!this instanceof e?new e(a):void(this.diffData=a)}var f={addClassToNode:function(a,b){return a&&b&&(a.classList?a.classList.add(b):new RegExp("(^| +)"+b+"( +|$)").test(a.className)||(a.className+=(a.className.length?" ":"")+b)),this},addTextContent:function(a,b){return a["textContent"in document.body?"textContent":"innerText"]=b,this},bindEvent:function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c),this},getHead:function(){return this._head||(this._head=document.head||document.getElementsByTagName("head")[0]),this._head},target:function(a){return a.target||a.srcElement}},g=d.prototype;g.types={ADD_LEFT:"+_",ADD_RIGHT:"_+",REMOVE_LEFT:"-_",REMOVE_RIGHT:"_-",CHANGE:"#"},g.getLines=function(a,b){var c,d=this.length;if(a=parseInt(a,10)||0,0>a&&(a=0),b&&(d=Math.min(a+b,this.length)),c={before:this.before.slice(a,d),after:this.after.slice(a,d)},c.before.length!==c.after.length)throw new Error("DiffData#getLines returned different number of lines");return c.length=c.before.length,c},g.getNthDiffFirstLineNumber=function(a){return a=parseInt(a,10)||0,"undefined"==typeof this._diffStartLines[a]?null:this._diffStartLines[a]},g.getLinesCount=function(){return this.length},g._initDiffData=function(a,b){var c=this,d=function(a,b){var d=c.diffModel.slice(),e={type:null,lines:0},f=d.shift(),g=function(a,b){for(var c=[],d=0;b>d;d+=1)c.push({type:a});return c};return a.reduce(function(a,h,i){var j=i,k=null;if(b)for(;f&&j>f.after_line_number;)f=d.shift();else for(;f&&j>f.before_line_number;)f=d.shift();return f&&(b?f.after_line_number===j&&(f.before_line_count?f.after_line_count?f.before_line_count&&(e.lines=f.after_line_count,e.type=c.types.CHANGE):a=a.concat(g(c.types.REMOVE_RIGHT,f.before_line_count)):(e.lines=f.after_line_count,e.type=c.types.ADD_RIGHT)):f.before_line_number===j&&(f.before_line_count?f.after_line_count?f.after_line_count&&(e.lines=f.before_line_count,e.type=c.types.CHANGE):(e.lines=f.before_line_count,e.type=c.types.REMOVE_LEFT):a=a.concat(g(c.types.ADD_LEFT,f.after_line_count)))),e&&e.lines&&!k&&(k=e.type,e.lines-=1),a.push({number:j,text:h,type:k}),a},[])};if(this.before=d(a),this.after=d(b,!0),this.before.length!==this.after.length)throw new Error("#before and #after have different lengths!");return this.length=this.before.length,this},g._setDiffStartLines=function(){var a=[],b=0;return this.diffModel.forEach(function(c){a.push(c.before_line_number+b),c.before_line_count||(b+=Math.max(c.before_line_count,c.after_line_count))}),this._diffStartLines=a,this};var h=e.prototype;h.init=function(a){return this._processOptions(a)._hideLoader()._determineLineHeight()._setNumbersWidth()._getPanels()._setLinesCount()._bindHandlers()._addOverview()},h._processOptions=function(a){var b={loaderSelector:".loader-wrapper",panelSelector:".wrapper",leftPanelSelector:".wrapper_left",rightPanelSelector:".wrapper_right",lineWrapper:{cls:"line-wrapper",tag:"div"},lineNumber:{cls:"line-number",tag:"span"},lineText:{cls:"line-text",tag:"span"},diffAddClass:"green",diffDelClass:"red",diffChangeClass:"yellow",MIN_HIDDEN_LINES_COUNT:200,overviewSelector:".overview",overviewChild:{cls:"overview__diff",height:10},pseudoScrollSelector:".overview-wrapper .position"};return a&&Object.keys(b).forEach(function(c){a.hasOwnProperty(c)&&(b[c]=a[c])}),this.o=b,this},h.displayPanels=function(a){var b,c=this.diffData.getLinesCount();return this.firstLine="undefined"!=typeof a?Math.min(parseInt(a,10)||0,c):this.firstLine,this.firstLine+this.linesInPanel>c&&(this.firstLine=c-this.linesInPanel+1),this.hiddenLines.before=Math.min(this.firstLine-1,this.hiddenLines.max),this.hiddenLines.after=Math.min(c-(this.firstLine+this.linesInPanel-1),this.hiddenLines.max),this.lineCount=this.linesInPanel+this.hiddenLines.before+this.hiddenLines.after,b=this.diffData.getLines(this.firstLine-this.hiddenLines.before-1,this.lineCount),this.stopScrolling=!1,this._addCodeToTarget(b.before,this.leftPanel),this._addCodeToTarget(b.after,this.rightPanel),this._scrollToFirstLine(),this._positionPseudoScroll(this.firstLine),this},h.clearPanels=function(){return this.leftPanel.innerHTML=this.rightPanel.innerHTML="",this.stopScrolling=!0,this},h.addLineToTarget=function(a,b){var c,d,e,g=document.createElement(this.o.lineWrapper.tag),h=document.createElement(this.o.lineNumber.tag),i=document.createElement(this.o.lineText.tag),j=function(){f.addClassToNode(g,c),f.addTextContent(h,d||b.number),f.addTextContent(i,e||b.text||" ")};switch(f.addClassToNode(g,this.o.lineWrapper.cls),f.addClassToNode(h,this.o.lineNumber.cls),f.addClassToNode(i,this.o.lineText.cls),b.type){case this.diffData.types.ADD_LEFT:c=this.o.diffAddClass,d="+";break;case this.diffData.types.ADD_RIGHT:c=this.o.diffAddClass;break;case this.diffData.types.REMOVE_RIGHT:c=this.o.diffDelClass,d="-";break;case this.diffData.types.REMOVE_LEFT:c=this.o.diffDelClass;break;case this.diffData.types.CHANGE:c=this.o.diffChangeClass}return j(),g.appendChild(h),g.appendChild(i),a.appendChild(g),this},h.scroll=function(a){return a<this.firstLine-this.hiddenLines.before/2&&this.hiddenLines.before>=this.hiddenLines.max?this._scrollUp(a):a>this.firstLine+(this.linesInPanel+this.hiddenLines.after)/2&&this.hiddenLines.after>=this.hiddenLines.max&&this._scrollDown(a),this},h._hideLoader=function(){return document.querySelector(this.o.loaderSelector).style.display="none",this},h._determineLineHeight=function(){var a,b=document.createElement(this.o.lineWrapper.tag);return b.style.position="absolute",b.style.left="-9999px",this.addLineToTarget(b,{text:"TEST",number:1}),document.body.appendChild(b),a=b.firstChild.getBoundingClientRect(),this.lineHeight=a.height||a.bottom-a.top,document.body.removeChild(b),this},h._getPanels=function(){return this.panels=document.querySelectorAll(this.o.panelSelector),this.leftPanel=document.querySelector(this.o.leftPanelSelector),this.rightPanel=document.querySelector(this.o.rightPanelSelector),this},h._setLinesCount=function(){var a=this.leftPanel.clientHeight;return this.linesInPanel=Math.ceil(a/this.lineHeight),this.hiddenLines={max:Math.max(this.o.MIN_HIDDEN_LINES_COUNT,2*this.linesInPanel)},this.hiddenLines.before=this.hiddenLines.after=this.hiddenLines.max,this.lineCount=this.linesInPanel+this.hiddenLines.before+this.hiddenLines.after,this.firstLine=0,this},h._setNumbersWidth=function(){var a=document.createElement("style"),b="."+this.o.lineNumber.cls+"{width:"+(this.diffData.getLinesCount()+"").length+"em;}";return a.setAttribute("type","text/css"),a.styleSheet?a.styleSheet.cssText=b:a.appendChild(document.createTextNode(b)),f.getHead().appendChild(a),this},h._addCodeToTarget=function(a,b,c){var d=document.createDocumentFragment(),e=this;return a.forEach(function(a){e.addLineToTarget(d,a)}),c?b.insertBefore(d,b.firstChild):b.appendChild(d),this},h._removeLines=function(a,b){return[this.leftPanel,this.rightPanel].forEach(function(c){for(var d=0;b>d;d+=1)c[a+"Child"]&&c.removeChild(c[a+"Child"])}),this},h._scrollUp=function(a){var b,c=Math.abs(this.firstLine-a),d=this.diffData.getLines(a-this.hiddenLines.before,c),e=d.length,f=e;return a<this.hiddenLines.before&&(this.hiddenLines.before=a),this.hiddenLines.after<this.hiddenLines.max&&(b=this.hiddenLines.max-this.hiddenLines.after,this.hiddenLines.after+=Math.min(b,f),f-=Math.min(b,f)),this._removeLines("last",f),this._addCodeToTarget(d.before,this.leftPanel,!0),this._addCodeToTarget(d.after,this.rightPanel,!0),this.firstLine=a,this.hiddenLines.before-=c-e,this._scrollToFirstLine(),this},h._scrollDown=function(a){var b,c=Math.abs(this.firstLine-a),d=this.diffData.getLines(this.firstLine+this.linesInPanel+this.hiddenLines.after,c),e=d.length,f=e;return this.hiddenLines.before<this.hiddenLines.max&&(b=this.hiddenLines.max-this.hiddenLines.before,this.hiddenLines.before+=Math.min(b,f),f-=Math.min(b,f)),this._removeLines("first",f),this._addCodeToTarget(d.before,this.leftPanel),this._addCodeToTarget(d.after,this.rightPanel),this.firstLine=a,this.hiddenLines.after-=c-e,this._scrollToFirstLine(),this},h._bindHandlers=function(){var a=this;return f.bindEvent(this.leftPanel,"scroll",function(b){var c=a.firstLine-a.hiddenLines.before+Math.floor(f.target(b).scrollTop/a.lineHeight);a.stopScrolling||(a.scroll(c),a.rightPanel.scrollTop=f.target(b).scrollTop,a.rightPanel.scrollLeft=f.target(b).scrollLeft),a._positionPseudoScroll(c)}),f.bindEvent(this.rightPanel,"scroll",function(b){a.stopScrolling||(a.leftPanel.scrollTop=f.target(b).scrollTop,a.leftPanel.scrollLeft=f.target(b).scrollLeft)}),this},h._scrollToFirstLine=function(){return this.leftPanel.scrollTop=(this.hiddenLines.before+1)*this.lineHeight,this},h._positionPseudoScroll=function(a){var b=document.querySelector(this.o.pseudoScrollSelector),c=document.querySelector(this.o.overviewSelector).clientHeight;return b.style.top=Math.floor(a/this.diffData.getLinesCount()*c)+"px",this},h._addOverview=function(){var a=this,b=document.querySelector(this.o.overviewSelector),c=this.diffData.getLinesCount()/b.clientHeight,d="data-diff";this.diffData.diffModel.map(function(a){var b=a.before_line_count&&a.after_line_count?"yellow":a.before_line_count&&!a.after_line_count?"red":"green";return{color:b,lineNumber:a.before_line_number,top:Math.floor(Math.min(a.before_line_number,a.after_line_number)/c)}}).forEach(function(c,e,g){var h=document.createElement("diff");f.addClassToNode(h,a.o.overviewChild.cls),h.setAttribute(d,e),h.style.top=c.top+"px",g[e-1]&&c.top-g[e-1].top<a.o.overviewChild.height&&(c.top+=a.o.overviewChild.height-c.top+g[e-1].top,h.style.top=c.top+"px"),h.style.backgroundColor=c.color,b.appendChild(h)}),f.bindEvent(b,"click",function(b){var c=f.target(b);c.getAttribute("data-diff")&&a.clearPanels().displayPanels(a.diffData.getNthDiffFirstLineNumber(c.getAttribute(d)))})};var i=new d(a.split("\n"),b.split("\n"),c),j=new e(i);j.init(),j.displayPanels(i.getNthDiffFirstLineNumber())}(content_before,content_after,diff_model);
//# sourceMappingURL=diff.min.map